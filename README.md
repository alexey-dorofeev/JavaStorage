# JavaStorage
## Сервис синхронизации файлов

Синхронизация файлов в папке:
- без вложенности, только файлы верхнего уровня
- без сборки содержимого файла из нескольких пакетов, данные одного файла передаются сразу
- ограничение на размер файла по-умолчанию: до 1 Кб
- без аутентификации клиента, клиент просто передает свой Id

#### Транспорт: встроенная сериализация объектов Netty:
```
...
ch.pipeline().addLast(new ObjectEncoder());
ch.pipeline().addLast(new ObjectDecoder(ClassResolvers.cacheDisabled(null)));
...
```

### Описание процесса синхронизации
#### 1. Клиент:
+ Сканирует папку
+ Вычисляет контрольные суммы файлов
+ Формирует пакет FileInfoSetMessage со следующими полями:

```
//Описание FileInfoSetMessage
//Идентификатор клиента
String clientId;
//Список файлов
Set<FileInfo> fileInfoSet;
```


```
//Описание FileInfo
//Стандартный объект File
File file;
//Контрольная сумма
String checkSum;
//Статус синхронизации
SyncStatus syncStatus = SyncStatus.NOT_SYNC;
//Данные файла
byte[] data;
```

#### 2. Сервер:
+ Принимает пакет от клиента
+ Создает папку для клиента, если она ранее не была создана
+ Сравнивает файлы в папке клиента с пришедшим списком файлов (по названию и контрольной сумме)
+ Помечает одинаковые файлы статусом SYNC
+ Если файл отличается, проверяет есть ли в пакете данные этого файла:
  + если данные есть, то перезаписывает эти данные в файл и помечает файл статусом SYNC
  + если данных нет, помечает отличающийся файлы статусом NOT_SYNC
+ Создает пустые недостающие файлы
+ Удаляет лишние файлы
+ Отправляет обратно клиенту список файлов
+ Если все файлы синхронизированы закрывает контекст

#### 3. Клиент:
+ Получает от сервера пакет со списком файлов
+ Если все файлы синхронизированы закрывает контекст, ждет 5000 мс и повторяет процесс синхронизации
+ Если есть не синхронизированные файлы, добавляет в пакет данные первого несинхронизированного файла и отправляет пакет серверу
